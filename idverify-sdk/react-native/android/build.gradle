buildscript {
    repositories {
        google()
        mavenCentral()
    }
    dependencies {
        classpath("com.android.tools.build:gradle:8.7.3")
        classpath("org.jetbrains.kotlin:kotlin-gradle-plugin:1.9.24")
    }
}

apply plugin: "com.android.library"
apply plugin: "kotlin-android"

android {
    namespace "com.idverify.bridge"
    compileSdkVersion 35

    defaultConfig {
        minSdkVersion 21
        targetSdkVersion 35
    }
    
    sourceSets {
        main {
            java.srcDirs += "src/main/java"
        }
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_17
        targetCompatibility JavaVersion.VERSION_17
    }

    kotlinOptions {
        jvmTarget = "17"
    }
}



dependencies {
    // React Native
    implementation "com.facebook.react:react-android:+"
    
    // Core SDK
    // We need two modes:
    // - When building this module as an AAR (AGP 8+), direct local .aar dependencies are not allowed -> use project dependency.
    // - When consuming from an app (e.g. rndemo/node_modules), the core SDK is available as a prebuilt AAR -> use files(...).
    def isBuildingAar = gradle.startParameter.taskNames.any { name ->
        def n = name.toLowerCase()
        n.contains("bundle") && n.contains("aar")
    }
    if (isBuildingAar) {
        implementation project(":idverify-sdk:android")
    } else {
        implementation files("/Users/yek/AndroidStudioProjects/idverify/idverify-sdk/android/build/outputs/aar/android-debug.aar")
    }
    
    // CameraX (needed for ViewManager)
    def camerax_version = "1.4.1"
    implementation "androidx.camera:camera-core:${camerax_version}"
    implementation "androidx.camera:camera-camera2:${camerax_version}"
    implementation "androidx.camera:camera-lifecycle:${camerax_version}"
    implementation "androidx.camera:camera-view:${camerax_version}"
    
    // ML Kit Text Recognition (Transitive dependency of Core SDK)
    implementation "com.google.mlkit:text-recognition:16.0.1"
}
